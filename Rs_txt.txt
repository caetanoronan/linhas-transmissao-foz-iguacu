Resumo dos Resultados
Total de munic√≠pios afetados: 298 munic√≠pios do Rio Grande do Sul s√£o atravessados por linhas de transmiss√£o.

Top 10 munic√≠pios com mais linhas:
Gravata√≠ - 25 linhas
Nova Santa Rita - 24 linhas
Canoas - 21 linhas
Caxias do Sul - 20 linhas
Porto Alegre - 19 linhas
Triunfo - 17 linhas
Eldorado do Sul - 16 linhas
Farroupilha - 15 linhas
Candiota - 14 linhas
Cachoeirinha - 12 linhas
Arquivos gerados:
municipios_afetados.txt - Lista completa de todos os 298 munic√≠pios
linhas_por_municipio.csv - Detalhamento de cada linha de transmiss√£o por munic√≠pio
resumo_por_municipio.csv - Quantidade de linhas por munic√≠pio ordenado
Os resultados mostram que a Regi√£o Metropolitana de Porto Alegre concentra a maior quantidade de linhas de transmiss√£o, o que √© esperado dado que √© a principal √°rea consumidora de energia do estado.

Carregando dados...
‚úì Linhas carregadas: 268 registros
‚úì Munic√≠pios carregados: 499 registros

Identificando munic√≠pios afetados...
‚úì Identificados 298 munic√≠pios afetados

Calculando quantidade de linhas por munic√≠pio...

======================================================================
EXPORTANDO SHAPEFILE
======================================================================

‚úì Shapefile criado com sucesso!
  Arquivo: municipios_afetados_linhas_transmissao.shp
  Munic√≠pios: 298
  CRS: EPSG:4674

Colunas inclu√≠das:
  - CD_MUN
  - NM_MUN
  - CD_RGI
  - NM_RGI
  - CD_RGINT
  - NM_RGINT
  - CD_UF
  - NM_UF
  - SIGLA_UF
  - CD_REGIA
  - NM_REGIA
  - SIGLA_RG
  - CD_CONCU
  - NM_CONCU
  - AREA_KM2
  - N_LINHAS

‚úì GeoPackage tamb√©m criado: municipios_afetados_linhas_transmissao.gpkg

======================================================================
ESTAT√çSTICAS
======================================================================
Total de munic√≠pios afetados: 298
Munic√≠pio com mais linhas: Gravata√≠ (25 linhas)
Munic√≠pio com menos linhas: Santo Ant√¥nio do Palma (1 linhas)
M√©dia de linhas por munic√≠pio: 3.19

‚úì Processo conclu√≠do!

Perfeito! O shapefile foi criado com sucesso! üéâ

Arquivos gerados:
Shapefile completo:
municipios_afetados_linhas_transmissao.shp (7.9 MB) - arquivo principal
municipios_afetados_linhas_transmissao.shx - √≠ndice espacial
municipios_afetados_linhas_transmissao.dbf (347 KB) - tabela de atributos
municipios_afetados_linhas_transmissao.prj - proje√ß√£o (SIRGAS 2000)
municipios_afetados_linhas_transmissao.cpg - codifica√ß√£o UTF-8
B√¥nus:
municipios_afetados_linhas_transmissao.gpkg (8.3 MB) - GeoPackage (formato moderno, arquivo √∫nico)
Conte√∫do:
O shapefile cont√©m 298 munic√≠pios do RS afetados pelas linhas de transmiss√£o, com todos os atributos originais mais:

N_LINHAS: quantidade de linhas de transmiss√£o que atravessam cada munic√≠pio
Voc√™ pode abrir estes arquivos em qualquer software GIS (QGIS, ArcGIS, etc.) para visualizar e analisar os munic√≠pios afetados!

Valeu pelo toque ‚Äî isso explica o ‚Äúsumi√ßo‚Äù de munic√≠pios. Dois pontos-chave:

Arquivo -shm n√£o √© o dado ‚Äúde verdade‚Äù
O ‚ÄúLinha_trans_RS.gpkg-shm‚Äù √© um arquivo tempor√°rio do SQLite/GeoPackage (sidecar). Ele n√£o guarda altera√ß√µes de forma persistente e n√£o √© lido pelo GeoPandas.
Quem vale √© o ‚Äú.gpkg‚Äù. Ou seja: √© preciso salvar/atualizar o dado em Linha_trans_RS.gpkg (ou no Linha_trans_RS.gpkg da raiz). Eu j√° ajustei o script para PRIORIZAR Linha_trans_RS.gpkg se ele existir.
Por que o mapa ficou incompleto antes
Antes, eu usei seu shapefile de munic√≠pios do RS, mas filtrava pelos nomes vindos do CSV para cada voltagem. Se o CSV n√£o listava todos os munic√≠pios que voc√™ adicionou, eles ficavam de fora.
Agora mudei a l√≥gica: para RS, eu pego seu shapefile de munic√≠pios como base e CALCULO os munic√≠pios afetados por voltagem fazendo a interse√ß√£o com as linhas do RS (com um pequeno buffer). Isso independe do CSV e evita perder munic√≠pios.
O que j√° atualizei no gerador

Linhas do RS: o gerador agora tenta primeiro Linha_trans_RS.gpkg (n√£o o .gpkg-shm) e auto-detecta a layer de linhas. Se existir coluna de tens√£o (Tensao/kV), filtra pela voltagem; sen√£o, usa como est√°.
Munic√≠pios do RS: em vez de filtrar pelo CSV, cruzo seu shapefile ‚ÄúRS/municipios_afetados_linhas_transmissao.shp‚Äù com as linhas da voltagem (buffer leve) e seleciono s√≥ os munic√≠pios que intersectam. Se der algum problema na interse√ß√£o, fa√ßo um filtro por bounding box das linhas para evitar que apare√ßa o estado inteiro.
O que voc√™ precisa fazer agora

Garanta que as suas edi√ß√µes em ‚Äúlinhas por munic√≠pio‚Äù estejam gravadas no Linha_trans_RS.gpkg (o .gpkg mesmo). O -shm n√£o serve para isso.
Se preferir, tamb√©m posso apontar o gerador para outro nome de arquivo .gpkg dentro da pasta RS ‚Äî √© s√≥ me dizer o nome/layer que voc√™ quer usar.
Opcional: quer que eu gere os mapas novamente j√°?

Se confirmar que o arquivo Linha_trans_RS.gpkg foi atualizado (ou me disser qual .gpkg usar), eu rodo o gerador e te entrego os HTMLs atualizados na pasta outputs/mapas.
Se quiser, tamb√©m deixo os mapas do RS exibirem ‚Äútodos os munic√≠pios‚Äù do seu shapefile em qualquer voltagem (ignorando o c√°lculo por linha), mas a abordagem por interse√ß√£o √© a mais fiel.
Resumo das melhorias aplicadas

RS usa seu shapefile de munic√≠pios como base de verdade.
Linhas do RS s√£o lidas do RS/Linha_trans_RS.gpkg, se existir.
Munic√≠pios afetados por voltagem s√£o calculados via interse√ß√£o com as linhas (buffer), n√£o pelo CSV.
Me diga s√≥: voc√™ j√° salvou as altera√ß√µes no RS/Linha_trans_RS.gpkg? Se sim, eu j√° regenero os mapas na sequ√™ncia.

Perfeito ‚Äî como voc√™ colocou os arquivos no municipios_afetados_linhas_transmissao.gpkg e RS/Linha_trans_RS.gpkg, eu j√° adaptei o gerador para:

Priorizar municipios_afetados_linhas_transmissao.gpkg como base de munic√≠pios do RS.
Ler Linha_trans_RS.gpkg para as linhas do RS (detectando a layer correta e filtrando por voltagem quando houver coluna de tens√£o).
Calcular os munic√≠pios afetados por voltagem via interse√ß√£o espacial r√°pida (spatial join ‚Äúintersects‚Äù) entre os munic√≠pios do RS e as linhas (com pequeno buffer), em vez de depender do CSV. Isso resolve o problema de munic√≠pios faltando.
Resultados r√°pidos

Teste interno mostrou:
RS 230 kV: 139 munic√≠pios afetados retornados.
RS 525 kV: 111 munic√≠pios afetados retornados.
Isso indica que a sele√ß√£o est√° pegando um conjunto bem mais completo.
O que falta para voc√™ ver nos mapas

Os HTMLs j√° foram gerados antes com a l√≥gica antiga. Posso regerar todos agora com a l√≥gica nova (isso leva alguns minutos porque processa todas as combina√ß√µes).
Se quiser agilizar, posso rodar s√≥ os do RS (230kV e 525kV) primeiro e voc√™ j√° confere se todos os munic√≠pios esperados aparecem.
Confirme s√≥:

Esses dois arquivos est√£o mesmo atualizados com suas edi√ß√µes?
municipios_afetados_linhas_transmissao.gpkg
Linha_trans_RS.gpkg
Quer que eu gere s√≥ os mapas do RS primeiro ou todos de uma vez?
Assim que voc√™ confirmar, eu rodo o gerador e te entrego os novos:

mapa_230kV_RS.html
mapa_525kV_RS.html
index.html atualizado
Observa√ß√µes t√©cnicas

Eu evitei a opera√ß√£o ‚Äúoverlay‚Äù pesada e usei spatial join, que √© bem mais r√°pido e suficiente para obter a lista de munic√≠pios afetados (n√£o precisamos da geometria da interse√ß√£o).
Mantive a simplifica√ß√£o de geometria e as camadas de ‚Äún√£o afetados‚Äù no fundo.
Se o arquivo -shm aparecer, ele √© s√≥ um tempor√°rio; o gerador ignora e usa o .gpkg ‚Äúde verdade‚Äù.
Se preferir, tamb√©m adiciono uma camada ‚ÄúTodos os afetados do RS (base)‚Äù que mostra todo o conjunto do seu GPKG (sem filtrar por voltagem), s√≥ para compara√ß√£o visual.

Obrigado por apontar ‚Äî li o arquivo Municipios_afetas_linhas.csv e acabei de ajustar o gerador para garantir que todos os munic√≠pios listados ali entrem nos mapas do RS.

O que mudei

Para RS, al√©m do c√°lculo espacial (sjoin intersect com as linhas por voltagem), eu agora complemento a sele√ß√£o com os munic√≠pios do CSV:
Leio Municipios_afetas_linhas.csv.
Uno os nomes desse CSV com os munic√≠pios detectados pelo sjoin.
Resultado: mesmo que a interse√ß√£o espacial perca algum munic√≠pio por toler√¢ncia/ajuste geom√©trico, ele entra por estar no CSV.
Mapas do RS regenerados

Atualizei os dois mapas do RS com essa inclus√£o:
mapa_230kV_RS.html
mapa_525kV_RS.html
O que verificar

Abra os dois HTMLs acima e confira se todos os munic√≠pios do CSV aparecem agora.
Se algum nome do CSV ainda n√£o estiver sendo puxado, me diga quais s√£o para eu checar:
Ortografia (ex.: ‚ÄúSanto Ant√¥nio do Palma‚Äù vs ‚ÄúSanto Antonio do Palma‚Äù).
Normaliza√ß√£o de mai√∫sculas/acentos (eu j√° comparo em mai√∫sculas).
Se o munic√≠pio existe no GPKG de munic√≠pios (para garantir que consigo localizar a geometria e desenhar).
Notas t√©cnicas

Usei seus GPKGs: municipios_afetados_linhas_transmissao.gpkg e Linha_trans_RS.gpkg.
O CSV n√£o tem coluna de voltagem; portanto, a inclus√£o vale para qualquer voltagem (os nomes do CSV s√£o somados aos detectados para 230 kV e tamb√©m para 525 kV). Se depois voc√™ quiser, posso adicionar uma coluna de voltagem nesse CSV e filtrar por voltagem de forma mais espec√≠fica.
Se quiser, eu listo rapidamente no console quais munic√≠pios do CSV foram adicionados em cada voltagem (diferen√ßa entre CSV e sjoin), para voc√™ auditar. Quer que eu rode essa listagem?

Agora entendi o problema ‚Äî as linhas est√£o corretas e cobrem todo o estado, mas a camada de munic√≠pios est√° mostrando s√≥ o norte porque o spatial join est√° filtrando apenas os munic√≠pios que intersectam com as linhas/buffer, mas deveria mostrar TODOS os munic√≠pios do CSV sem filtrar.

Perfeito ‚Äî achei o erro! Era exatamente isso: eu estava fazendo spatial join (interse√ß√£o geom√©trica) que s√≥ pegava os munic√≠pios onde a linha cruzava, ent√£o s√≥ aparecia o norte do estado.

O que corrigi
Agora, para o RS, ignoro completamente o c√°lculo espacial e uso direto todos os 298 munic√≠pios do seu CSV Municipios_afetas_linhas.csv, independente de voltagem ou interse√ß√£o. Assim:

Linhas de transmiss√£o: continuam sendo lidas do Linha_trans_RS.gpkg e filtradas por voltagem (230 kV, 525 kV, etc.) ‚Äî isso est√° correto.
Munic√≠pios afetados: agora pego todos os nomes do CSV e desenho as geometrias correspondentes do GPKG de munic√≠pios ‚Äî sem filtrar por spatial join.
Mapas atualizados
Regenerei os dois mapas do RS:

mapa_230kV_RS.html ‚Äî agora com 298 munic√≠pios (todos do CSV)
mapa_525kV_RS.html ‚Äî tamb√©m com 298 munic√≠pios (todos do CSV)
Verifique agora
Abra os dois HTMLs e confirme que:

‚úÖ Munic√≠pios aparecem em todas as regi√µes do RS (norte, sul, leste, oeste, centro).
‚úÖ Linhas de transmiss√£o continuam corretas e cobrindo todo o estado.
‚úÖ Buffer/faixa de servid√£o tamb√©m continua mostrando corretamente.
Se quiser que eu separe os munic√≠pios por voltagem no CSV (adicionar uma coluna "Voltagem" ou "N_LINHAS" para filtrar 230 vs 525), posso fazer isso ‚Äî mas agora todos os 298 aparecem em ambos os mapas, garantindo cobertura completa.

GERADOR DE CSV COM VOLTAGEM POR MUNIC√çPIO - RS
============================================================

üìÇ Lendo CSV original...
  ‚úì 298 munic√≠pios no CSV

üìÇ Lendo munic√≠pios do GPKG...
  ‚úì 298 munic√≠pios no GPKG

üìÇ Lendo linhas de transmiss√£o...
  ‚úì 268 linhas carregadas
  ‚úì Coluna de tens√£o: Tensao

üîß Criando buffer nas linhas...

üîç Detectando voltagens por munic√≠pio (spatial join)...
  ‚úì 298 munic√≠pios com voltagens detectadas

============================================================
‚úÖ CSV gerado com sucesso!
üìÑ Arquivo: c:\Users\caetanoronan\OneDrive - UFSC\√Årea de Trabalho\Afetados_ln_trans\RS\Municipios_afetas_linhas_por_voltagem.csv
üìä Total de registros: 382
üìä Munic√≠pios √∫nicos: 298

Distribui√ß√£o por voltagem:
Voltagem
230    226
525    154
500      1
132      1
============================================================